{"version":3,"file":"formiz-core.umd.development.js","sources":["../src/utils/form.utils.ts","../src/utils/global.utils.ts","../src/utils/useRefValue.ts","../src/utils/useSubject.ts","../src/formActions.ts","../src/fieldsActions.ts","../src/Formiz.tsx","../src/errors/index.ts","../src/FormizStep.tsx","../src/types/field.types.ts","../src/useField.ts","../src/useForm.ts"],"sourcesContent":["import { FormFields } from '../types/form.types';\n\nconst isObject = (x: any) => x && typeof x === 'object' && x.constructor === Object;\n\nconst parseValues = (values: any) => Object.keys(values)\n  .reduce(\n    (acc, key) => parseValuesName(key, acc), // eslint-disable-line\n    values,\n  );\n\nconst parseValuesName = (name: any, values: any): any => {\n  if (name.indexOf('.') < 0 && name.indexOf('[') < 0) {\n    return values;\n  }\n\n  const value = values[name];\n  const { [name]: deletedKey, ...nextValues } = values || {};\n  const [current, ...otherNames] = name.split('.');\n  const isArraySyntax = current.match(/\\[([0-9]*)\\]$/g);\n\n  if (isArraySyntax) {\n    const [currentName,, currentIndex] = current.split(/(\\[|\\])/g);\n    const currentCollection = values[currentName] || [];\n\n    if (otherNames.length) {\n      const group = {\n        ...(values[currentName] && isObject(values[currentName][currentIndex])\n          ? values[currentName][currentIndex]\n          : {}\n        ),\n        [otherNames.join('.')]: value,\n      };\n\n      currentCollection[currentIndex] = parseValues(group);\n    } else {\n      currentCollection[currentIndex] = value;\n    }\n\n    return {\n      ...nextValues,\n      [currentName]: currentCollection,\n    };\n  }\n\n  const group = {\n    ...(isObject(values[current]) ? values[current] : {}),\n    [otherNames.join('.')]: value,\n  };\n\n  return {\n    ...nextValues,\n    [current]: parseValues(group),\n  };\n};\n\nexport const getFormValues = (fields: FormFields) => {\n  const values = (fields || [])\n    .filter((field) => field.isEnabled)\n    .reduce((obj, field) => ({\n      ...obj,\n      [field.name]: field.value,\n    }), {});\n\n  return parseValues(values);\n};\n","export const getFormUniqueId = (): string => `form-${Math.random().toString(36).substr(2, 9)}`;\nexport const getFieldUniqueId = (): string => `field-${Math.random().toString(36).substr(2, 9)}`;\nexport const getFieldHtmlUniqueId = (formId: string, fieldName: string): string => `formiz-${formId}-field-${fieldName}`;\n","import { useRef } from 'react';\n\nexport const useRefValue = (value: any): React.RefObject<any> => {\n  const ref = useRef(value);\n  ref.current = value;\n  return ref;\n};\n","import React, { useRef } from 'react';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { throttleTime } from 'rxjs/operators';\n\nexport const useSubject = (valueRef: React.RefObject<any>, throttle = 100) => {\n  const subjectRef = useRef(new Subject());\n  const push = (value?: any) => {\n    subjectRef.current.next(value ?? valueRef.current);\n  };\n\n  const subscription = subjectRef.current\n    .pipe(throttleTime(throttle, undefined, { leading: true, trailing: true }));\n\n  return { push, subscription };\n};\n\n\nexport const useBehaviorSubject = (valueRef: React.RefObject<any>, throttle = 100) => {\n  const subjectRef = useRef(new BehaviorSubject(valueRef.current));\n  const push = (value?: any) => {\n    subjectRef.current.next(value ?? valueRef.current);\n  };\n\n  const subscription = subjectRef.current\n    .pipe(throttleTime(throttle, undefined, { leading: true, trailing: true }));\n\n  return { push, subscription };\n};\n","import { FormState } from './types/form.types';\nimport { StepState } from './types/step.types';\n\nexport const updateStep = (state: FormState, partialStepState: Partial<StepState>): FormState => {\n  if (!partialStepState || !partialStepState.name) return state;\n\n  const stepIndex = state.steps.findIndex((x: StepState) => x.name === partialStepState.name);\n  const step = state.steps[stepIndex];\n\n  const newStep: StepState = {\n    ...(step || {}),\n    ...partialStepState,\n  };\n\n  if (JSON.stringify(newStep) === JSON.stringify(step)) {\n    return state;\n  }\n\n  const newSteps = [...state.steps];\n\n  if (!step) {\n    newSteps.push(newStep);\n  } else {\n    newSteps[stepIndex] = newStep;\n  }\n\n  const orderedSteps = newSteps\n    .sort((a, b) => a.order - b.order);\n\n  const enabledSteps = orderedSteps.filter(({ isEnabled }) => isEnabled);\n\n  const initialStepName = enabledSteps.length ? enabledSteps[0].name : null;\n\n  const newState = {\n    ...state,\n    initialStepName,\n    steps: orderedSteps,\n  };\n\n  return newState;\n};\n\nexport const unregisterStep = (state: FormState, name: string): FormState => {\n  if (!name) return state;\n  const newState = {\n    ...state,\n    steps: state.steps.filter((x) => x.name !== name),\n  };\n  return newState;\n};\n\nexport const resetForm = (state: FormState): FormState => {\n  const newState = {\n    ...state,\n    resetKey: state.resetKey + 1,\n    isSubmitted: false,\n    isValid: true,\n    navigatedStepName: null,\n    steps: state.steps.map((step) => ({\n      ...step,\n      isSubmitted: false,\n      isVisited: false,\n    })),\n  };\n  return newState;\n};\n","import { FormFields } from './types/form.types';\nimport { Field } from './types/field.types';\n\nexport const registerField = (\n  fields: FormFields,\n  newField: Field,\n): FormFields => {\n  if (!newField) return fields;\n\n  const field = fields.find((x: Field) => x.id === newField.id);\n  const otherFields = fields.filter((x: Field) => x.id !== newField.id);\n\n  if (JSON.stringify(newField) === JSON.stringify(field)) {\n    return fields;\n  }\n\n  return [\n    ...otherFields,\n    { ...newField },\n  ];\n};\n\n\nexport const updateField = (\n  fields: FormFields,\n  newField: Field,\n): FormFields => {\n  if (!newField) return fields;\n\n  const field = fields.find((x: Field) => x.id === newField.id);\n  const otherFields = fields.filter((x: Field) => x.id !== newField.id);\n\n  if (JSON.stringify(newField) === JSON.stringify(field)) {\n    return fields;\n  }\n\n  return [\n    ...otherFields,\n    {\n      ...newField,\n    },\n  ];\n};\n\nexport const unregisterField = (\n  fields: FormFields,\n  fieldId: Field['id'],\n): FormFields => {\n  if (!fieldId) return fields;\n  const otherFields = fields.filter((x: Field) => x.id !== fieldId);\n  return [...otherFields];\n};\n\nexport const setFieldsValues = (\n  fields: FormFields,\n  objectOfValues: any = {},\n): FormFields => {\n  if (!objectOfValues) return fields;\n\n  const newFields = fields.map((field: Field) => ({\n    ...field,\n    value: objectOfValues[field.name] ?? field.value,\n  }));\n\n  return [...newFields];\n};\n\nexport const setFieldsExternalErrors = (\n  fields: FormFields,\n  objectOfErrors: any = {},\n): FormFields => {\n  if (!objectOfErrors) return fields;\n\n  const newFields = fields.map((field: Field) => ({\n    ...field,\n    externalErrors: objectOfErrors[field.name]\n      ? [objectOfErrors[field.name], field.externalErrors]\n      : field.externalErrors,\n  }));\n\n  return [...newFields];\n};\n","import * as React from 'react';\nimport {\n  useEffect, useRef, useContext,\n} from 'react';\nimport { Field } from './types/field.types';\nimport {\n  useRefValue, getFormValues, useSubject, useBehaviorSubject, getFormUniqueId,\n} from './utils';\nimport {\n  FormMethods, FormState, FormContextValue, FormizProps, FormFields, KeepValues,\n} from './types/form.types';\nimport { StepState } from './types/step.types';\nimport * as formActions from './formActions';\nimport * as fieldsActions from './fieldsActions';\n\nexport const defaultFormActions: FormMethods = {\n  submit: () => {},\n  setFieldsValues: () => {},\n};\n\nexport const defaultFormState: FormState = {\n  id: getFormUniqueId(),\n  resetKey: 0,\n  isSubmitted: false,\n  isValidating: false,\n  isValid: true,\n  isPristine: true,\n  steps: [],\n  initialStepName: null,\n  navigatedStepName: null,\n};\n\nexport const FormContext = React.createContext<FormContextValue>({});\nexport const useFormContext = () => useContext(FormContext);\n\nconst getCurrentStep = (formState: FormState) => {\n  const currentStepName = formState.navigatedStepName\n    || formState.initialStepName;\n  return formState.steps\n    .find((x) => x.name === currentStepName);\n};\n\nexport const Formiz = ({\n  autoForm = false,\n  children = '',\n  connect = {},\n  id = getFormUniqueId(),\n  onChange = () => {},\n  onSubmit = () => {},\n  onValidSubmit = () => {},\n  onInvalidSubmit = () => {},\n  onValid = () => {},\n  onInvalid = () => {},\n}: FormizProps) => {\n  const formStateRef = useRef<FormState>({\n    ...defaultFormState,\n    id,\n  });\n  const fieldsRef = useRef<FormFields>([]);\n  const keepValuesRef = useRef<KeepValues>({});\n  const connectRef = useRefValue(connect.__connect__ || (() => {}));\n  const onChangeRef = useRefValue(onChange);\n  const onSubmitRef = useRefValue(onSubmit);\n  const onValidSubmitRef = useRefValue(onValidSubmit);\n  const onInvalidSubmitRef = useRefValue(onInvalidSubmit);\n  const onValidRef = useRefValue(onValid);\n  const onInvalidRef = useRefValue(onInvalid);\n\n  const onFormUpdate = useBehaviorSubject(formStateRef);\n  const onFieldsUpdate = useBehaviorSubject(fieldsRef);\n  const onExternalFieldsUpdate = useSubject(fieldsRef);\n  const onReset = useSubject(formStateRef);\n\n  const checkFormValidity = (): boolean => {\n    const isValid = fieldsRef.current\n      .every((field: any) => (\n        !field?.errors?.length\n        && !field?.asyncErrors?.length\n        && !field?.externalErrors?.length\n      ));\n\n    if (isValid) {\n      onValidRef.current();\n    } else {\n      onInvalidRef.current();\n    }\n\n    return isValid;\n  };\n\n  const checkStepValidity = (stepName: string): boolean => fieldsRef.current\n    .filter((field) => field.stepName === stepName)\n    .every((field: any) => (\n      !field?.errors?.length\n      && !field?.asyncErrors?.length\n      && !field?.externalErrors?.length\n    ));\n\n  const checkFormPristine = (): boolean => fieldsRef.current\n    .every((field: any) => field?.isPristine);\n\n  const checkStepPristine = (stepName: string): boolean => fieldsRef.current\n    .filter((field) => field.stepName === stepName)\n    .every((field: any) => field?.isPristine);\n\n  const checkFormValidating = (): boolean => fieldsRef.current\n    .some((field: any) => field?.isValidating);\n\n  const checkStepValidating = (stepName: string): boolean => fieldsRef.current\n    .filter((field) => field.stepName === stepName)\n    .some((field: any) => field?.isValidating);\n\n  const updateFormState = (stateToUpdate: Partial<FormState>): void => {\n    const newState = { ...formStateRef.current, ...stateToUpdate };\n    if (JSON.stringify(newState) === JSON.stringify(formStateRef.current)) {\n      return;\n    }\n    formStateRef.current = newState;\n    onFormUpdate.push();\n  };\n\n  const goToStep = (stepName: string) => {\n    const enabledSteps = formStateRef.current.steps\n      .filter(({ isEnabled }) => isEnabled);\n    const targetedStepIndex = enabledSteps\n      .findIndex(({ name }) => name === stepName);\n\n    if (targetedStepIndex < 0) {\n      return;\n    }\n\n    updateFormState({\n      navigatedStepName: enabledSteps[targetedStepIndex].name,\n    });\n  };\n\n  const nextStep = () => {\n    const enabledSteps = formStateRef.current.steps.filter((x) => x.isEnabled);\n    const stepIndex = enabledSteps\n      .findIndex((step) => step.name === getCurrentStep(formStateRef.current)?.name);\n    const isLastStep = stepIndex === enabledSteps.length - 1;\n\n    if (isLastStep) {\n      return;\n    }\n\n    goToStep(enabledSteps[stepIndex + 1].name);\n  };\n\n  const prevStep = () => {\n    const enabledSteps = formStateRef.current.steps.filter((x) => x.isEnabled);\n    const stepIndex = enabledSteps\n      .findIndex((step) => step.name === getCurrentStep(formStateRef.current)?.name);\n    const isFirstStep = stepIndex === 0;\n\n    if (isFirstStep) {\n      return;\n    }\n\n    goToStep(enabledSteps[stepIndex - 1].name);\n  };\n\n  const submit = (e?: React.FormEvent<HTMLFormElement>) => {\n    if (e) e.preventDefault();\n\n    const { steps } = formStateRef.current;\n    updateFormState({\n      isSubmitted: true,\n      steps: steps.map((step) => ({ ...step, isSubmitted: true })),\n    });\n\n    const formatedValues = getFormValues(fieldsRef.current);\n\n    if (formStateRef.current.isValid && !formStateRef.current.isValidating) {\n      onValidSubmitRef.current(formatedValues);\n    } else {\n      onInvalidSubmitRef.current(formatedValues);\n    }\n\n    onSubmitRef.current(formatedValues);\n  };\n\n  const submitStep = (e?: React.FormEvent<HTMLFormElement>) => {\n    if (e) e.preventDefault();\n\n    updateFormState({\n      steps: formStateRef.current.steps.map((step) => ({\n        ...step,\n        isSubmitted: step.name === getCurrentStep(formStateRef.current)?.name\n          ? true\n          : step.isSubmitted,\n      })),\n    });\n\n    const currentStep = getCurrentStep(formStateRef.current);\n\n    if (!currentStep?.isValid || currentStep?.isValidating) {\n      return;\n    }\n\n    const enabledSteps = formStateRef.current.steps.filter((x) => x.isEnabled);\n    const currentStepName = getCurrentStep(formStateRef.current)?.name;\n    const isLastStep = enabledSteps[enabledSteps.length - 1]?.name === currentStepName;\n\n    if (isLastStep) {\n      submit();\n      return;\n    }\n\n    nextStep();\n  };\n\n  const setFieldsValues = (objectOfValues = {}) => {\n    fieldsRef.current = fieldsActions.setFieldsValues(fieldsRef.current, objectOfValues);\n    onExternalFieldsUpdate.push();\n  };\n\n  const invalidateFields = (objectOfErrors = {}) => {\n    fieldsRef.current = fieldsActions.setFieldsExternalErrors(fieldsRef.current, objectOfErrors);\n    onExternalFieldsUpdate.push();\n  };\n\n  const getFieldStepName = (fieldName: string) => fieldsRef.current\n    .find((field: Field) => fieldName === field.name)?.stepName ?? null;\n\n  const validateForm = () => {\n    updateFormState({\n      isValid: checkFormValidity(),\n      isPristine: checkFormPristine(),\n      isValidating: checkFormValidating(),\n      steps: formStateRef.current.steps.map((step) => ({\n        ...step,\n        isValid: checkStepValidity(step.name),\n        isPristine: checkStepPristine(step.name),\n        isValidating: checkStepValidating(step.name),\n      })),\n    });\n  };\n\n  const updateStep = (step: Partial<StepState>): void => {\n    updateFormState(formActions.updateStep(formStateRef.current, step));\n    validateForm();\n  };\n\n  const unregisterStep = (name: string): void => {\n    updateFormState({\n      ...formActions.unregisterStep(formStateRef.current, name),\n      isValid: checkFormValidity(),\n    });\n    validateForm();\n  };\n\n  const registerField = (field: Field): void => {\n    delete keepValuesRef.current[field.name];\n    fieldsRef.current = fieldsActions.registerField(fieldsRef.current, field);\n    onFieldsUpdate.push();\n    onChangeRef.current(getFormValues(fieldsRef.current));\n    validateForm();\n  };\n\n  const updateField = (field: Field): void => {\n    fieldsRef.current = fieldsActions.updateField(fieldsRef.current, field);\n    onFieldsUpdate.push();\n    onChangeRef.current(getFormValues(fieldsRef.current));\n    validateForm();\n  };\n\n  const unregisterField = (field: Field, shouldKeepValue: boolean): void => {\n    if (shouldKeepValue) {\n      keepValuesRef.current[field.name] = field.value;\n    }\n    fieldsRef.current = fieldsActions.unregisterField(fieldsRef.current, field.id);\n    onFieldsUpdate.push();\n    onChangeRef.current(getFormValues(fieldsRef.current));\n    validateForm();\n  };\n\n  const reset = (): void => {\n    updateFormState(formActions.resetForm(formStateRef.current));\n    keepValuesRef.current = {};\n    onReset.push();\n  };\n\n  const formMethods: FormMethods = {\n    submit,\n    submitStep,\n    setFieldsValues,\n    invalidateFields,\n    getFieldStepName,\n    goToStep,\n    nextStep,\n    prevStep,\n    reset,\n  };\n\n  const contextValue: FormContextValue = {\n    formStateRef,\n    fieldsRef,\n    actions: {\n      updateStep,\n      unregisterStep,\n      registerField,\n      updateField,\n      unregisterField,\n    },\n    formMethods,\n    keepValuesRef,\n    subjects: {\n      onFormUpdate,\n      onFieldsUpdate,\n      onExternalFieldsUpdate,\n      onReset,\n    },\n  };\n\n  // Connect\n  useEffect(() => {\n    connectRef.current(contextValue);\n  }, []);\n\n  return (\n    <FormContext.Provider value={contextValue}>\n      {!autoForm\n        ? children\n        : (\n          <form noValidate onSubmit={submit}>\n            {children}\n          </form>\n        )}\n    </FormContext.Provider>\n  );\n};\n","// Fields errors\nexport const ErrorFieldWithoutForm = new Error('A Formiz field always needs to be a children of a `<Formiz>` component.');\nexport const ErrorFieldWithoutName = new Error('A Formiz field (component using a useField hook) always needs a `name` props.');\n\n// Steps errors\nexport const ErrorStepWithoutForm = new Error('A <FormizStep> always needs to be a children of a `<Formiz>` component.');\nexport const ErrorStepWithoutName = new Error('A <FormizStep> always needs a `name` props.');\n","import * as React from 'react';\nimport {\n  useContext, useEffect, useState,\n} from 'react';\nimport { FormizStepProps, StepState } from './types/step.types';\nimport { ErrorStepWithoutName, ErrorStepWithoutForm } from './errors';\nimport { useFormContext, defaultFormState } from './Formiz';\n\nexport const StepContext = React.createContext<any>({});\nexport const useStepContext = () => useContext(StepContext);\n\nexport const FormizStep = ({\n  as: Tag = 'div',\n  children,\n  name,\n  label,\n  order,\n  isEnabled = true,\n  style = {},\n  ...rest\n}: FormizStepProps) => {\n  if (!name) {\n    throw ErrorStepWithoutName;\n  }\n\n  const {\n    formStateRef,\n    actions,\n    subjects,\n  } = useFormContext();\n\n  if (!subjects || !actions) {\n    throw ErrorStepWithoutForm;\n  }\n\n  const [formState, setFormState] = useState(formStateRef?.current ?? defaultFormState);\n  const [state, setState] = useState<Partial<StepState>>({\n    name,\n    label,\n    isVisited: false,\n    order: order ?? 0,\n  });\n  const isActive = formState.navigatedStepName\n    ? formState.navigatedStepName === name\n    : formState.initialStepName === name;\n\n  // Subscribe to form state\n  useEffect(() => {\n    const subscription = subjects.onFormUpdate\n      .subscription\n      .subscribe(setFormState);\n    return () => subscription.unsubscribe();\n  }, []);\n\n  useEffect(() => {\n    if (formState.navigatedStepName === name && !state.isVisited && isActive) {\n      setState((prevState) => ({ ...prevState, isVisited: true }));\n    }\n  });\n\n  // Register / Update the step\n  useEffect(() => {\n    actions.updateStep({\n      ...state,\n      isEnabled,\n    });\n  }, [state, isEnabled]);\n\n  // Unregister the step\n  useEffect(() => () => {\n    actions.unregisterStep(name);\n  }, [name]);\n\n  if (!isEnabled) {\n    return null;\n  }\n\n  return (\n    <StepContext.Provider value={{\n      name,\n    }}\n    >\n      <Tag\n        style={{\n          ...style,\n          display: !isActive ? 'none' : null,\n        }}\n        {...rest}\n      >\n        {isEnabled && children}\n      </Tag>\n    </StepContext.Provider>\n  );\n};\n","import PropTypes from 'prop-types';\n\nexport type FieldValue = any; // eslint-disable-line\n\nexport interface FieldValidationObject {\n  rule(value: FieldValue): boolean;\n  message?: string;\n  deps?: any[];\n}\nexport interface FieldAsyncValidationObject {\n  rule(value: FieldValue): Promise<boolean>;\n  message?: string;\n  deps?: any[];\n}\n\nexport interface UseFieldProps {\n  name: string;\n  debounce?: number;\n  defaultValue?: FieldValue;\n  formatValue?(value: FieldValue): FieldValue;\n  onChange?(value: FieldValue, rawValue: FieldValue): void;\n  required?: boolean;\n  validations?: FieldValidationObject[];\n  asyncValidations?: FieldAsyncValidationObject[];\n  keepValue?: boolean;\n}\n\nexport const fieldPropTypes = {\n  name: PropTypes.string.isRequired,\n  debounce: PropTypes.number,\n  defaultValue: PropTypes.any,\n  formatValue: PropTypes.func,\n  onChange: PropTypes.func,\n  required: PropTypes.oneOfType([PropTypes.bool, PropTypes.node]),\n  validations: PropTypes.arrayOf(PropTypes.shape({\n    rule: PropTypes.func,\n    message: PropTypes.node,\n    deps: PropTypes.arrayOf(PropTypes.any),\n  })),\n  asyncValidations: PropTypes.arrayOf(PropTypes.shape({\n    rule: PropTypes.func,\n    message: PropTypes.node,\n    deps: PropTypes.arrayOf(PropTypes.any),\n  })),\n  keepValue: PropTypes.bool,\n};\n\nexport const fieldDefaultProps: Omit<UseFieldProps, 'name'> = {\n  debounce: 100,\n  defaultValue: null,\n  formatValue: (val: FieldValue): FieldValue => val,\n  onChange: () => {},\n  required: false,\n  validations: [],\n  asyncValidations: [],\n  keepValue: false,\n};\n\nexport interface Field {\n  id: string;\n  resetKey: number;\n  name: string;\n  errors: (string | undefined)[];\n  asyncErrors: (string | undefined)[];\n  externalErrors: string[];\n  value: FieldValue;\n  valueDebounced: FieldValue;\n  isValidating: boolean;\n  isPristine: boolean;\n  isEnabled: boolean;\n  stepName?: string;\n}\n\nexport interface FieldState {\n  id: string;\n  resetKey: number;\n  errors: (string | undefined)[];\n  asyncErrors: (string | undefined)[];\n  externalErrors: string[];\n  value: FieldValue;\n  valueDebounced: FieldValue;\n  isValidating: boolean;\n  isPristine: boolean;\n  isEnabled: boolean;\n}\n\nexport interface UseFieldValues {\n  errorMessage?: string | undefined;\n  errorMessages?: (string | undefined)[];\n  id: string;\n  isPristine: boolean;\n  isSubmitted: boolean;\n  isValid: boolean;\n  isValidating: boolean;\n  setValue(value: FieldValue): void;\n  value: FieldValue;\n  valueDebounced: FieldValue;\n  resetKey: number;\n}\n","import {\n  useState, useEffect, useRef,\n} from 'react';\nimport {\n  FieldValue,\n  UseFieldProps,\n  UseFieldValues,\n  FieldState,\n  FieldValidationObject,\n  FieldAsyncValidationObject,\n  fieldDefaultProps,\n} from './types/field.types';\nimport { FormFields } from './types/form.types';\nimport { StepState } from './types/step.types';\nimport { ErrorFieldWithoutForm, ErrorFieldWithoutName } from './errors';\nimport { getFieldUniqueId, useRefValue, getFieldHtmlUniqueId } from './utils';\nimport { useFormContext, defaultFormState } from './Formiz';\nimport { useStepContext } from './FormizStep';\n\nconst getValidationsWithRequired = (\n  validations: FieldValidationObject[],\n  required?: boolean | string,\n) => {\n  if (!required && required !== '') {\n    return validations;\n  }\n  return [\n    ...validations,\n    {\n      rule: (x: FieldValue) => !!x || x === 0,\n      message: required !== true ? required : '',\n    }];\n};\n\nexport const useField = ({\n  name,\n  debounce = fieldDefaultProps.debounce,\n  defaultValue = fieldDefaultProps.defaultValue,\n  formatValue = fieldDefaultProps.formatValue,\n  onChange = fieldDefaultProps.onChange,\n  required = fieldDefaultProps.required,\n  validations = fieldDefaultProps.validations,\n  asyncValidations = fieldDefaultProps.asyncValidations,\n  keepValue = fieldDefaultProps.keepValue,\n}: UseFieldProps): UseFieldValues => {\n  if (!name) {\n    throw ErrorFieldWithoutName;\n  }\n\n  const {\n    formStateRef,\n    actions,\n    subjects,\n    keepValuesRef,\n  } = useFormContext();\n\n  if (!subjects || !actions || !keepValuesRef) {\n    throw ErrorFieldWithoutForm;\n  }\n\n  const isMountedRef = useRef(true);\n  const stepContext = useStepContext();\n  const stepName = stepContext?.name;\n\n  const [formState, setFormState] = useState(formStateRef?.current ?? defaultFormState);\n  const initValue = keepValuesRef.current?.[name] ?? defaultValue;\n  const [state, setState] = useState<FieldState>({\n    id: getFieldUniqueId(),\n    resetKey: 0,\n    value: initValue,\n    valueDebounced: initValue,\n    errors: [],\n    asyncErrors: [],\n    externalErrors: [],\n    isValidating: false,\n    isPristine: true,\n    isEnabled: true,\n  });\n  const stateRef = useRefValue(state);\n  const nameRef = useRefValue(name);\n  const stepNameRef = useRefValue(stepName);\n  const validationsRef = useRefValue(getValidationsWithRequired(validations || [], required));\n  const asyncValidationsRef = useRefValue(asyncValidations || []);\n  const debounceRef = useRefValue(debounce);\n  const onChangeRef = useRefValue(onChange);\n  const formatValueRef = useRefValue(formatValue);\n  const defaultValueRef = useRefValue(defaultValue);\n  const keepValueRef = useRefValue(keepValue);\n  const currentStepName = formState.navigatedStepName\n    || formState.initialStepName;\n  const currentStep: (StepState | null) = formState.steps\n    .find((x) => x.name === currentStepName) || null;\n\n  const setValue = (value: FieldValue) => {\n    setState((prevState: FieldState) => ({\n      ...prevState,\n      externalErrors: [],\n      value,\n      isPristine: false,\n    }));\n    onChangeRef.current(formatValueRef.current(value), value);\n  };\n\n  // Subscribe to form state\n  useEffect(() => {\n    const subscription = subjects.onFormUpdate\n      .subscription\n      .subscribe(setFormState);\n    return () => subscription.unsubscribe();\n  }, []);\n\n  // Subscribe to external updates\n  useEffect(() => {\n    const subscription = subjects.onExternalFieldsUpdate\n      .subscription\n      .subscribe((fields: FormFields) => {\n        const field = fields.find((x) => x.id === stateRef.current.id);\n        if (field && JSON.stringify(field) !== JSON.stringify(stateRef.current)) {\n          setState(field);\n        }\n      });\n    return () => subscription.unsubscribe();\n  }, []);\n\n  // Subscribe to reset\n  useEffect(() => {\n    const subscription = subjects.onReset\n      .subscription\n      .subscribe(() => {\n        setState((prevState) => ({\n          ...prevState,\n          error: [],\n          externalErrors: [],\n          resetKey: prevState.resetKey + 1,\n          isPristine: true,\n          value: defaultValueRef.current,\n        }));\n        onChangeRef.current(\n          formatValueRef.current(defaultValueRef.current),\n          defaultValueRef.current,\n        );\n      });\n    return () => subscription.unsubscribe();\n  }, []);\n\n\n  // Update validations\n  useEffect(() => {\n    const validateField = async () => {\n      /**\n       * Sync validations\n       */\n\n      const fieldErrors = (validationsRef.current || [])\n        .reduce(\n          (errors: any, validation: FieldValidationObject) => (!validation.rule(state.value)\n            ? [...errors, validation.message]\n            : errors),\n          [],\n        );\n\n      const shouldRunAsyncValidations = (\n        !fieldErrors.length\n        && !!(asyncValidationsRef.current || []).length\n      );\n\n      setState((prevState: FieldState) => ({\n        ...prevState,\n        errors: fieldErrors,\n        asyncErrors: [],\n        valueDebounced: prevState.value,\n        isValidating: shouldRunAsyncValidations,\n      }));\n\n      if (!shouldRunAsyncValidations) {\n        return;\n      }\n\n      /**\n       * Async validations\n       */\n\n      const rules = await Promise.all((asyncValidationsRef.current || [])\n        .map(async (validation: FieldAsyncValidationObject) => {\n          const isValid = await validation.rule(state.value);\n          return {\n            ...validation,\n            isValid,\n          };\n        }));\n\n      if (\n        !isMountedRef.current\n        || state.value !== stateRef.current.value\n      ) {\n        return;\n      }\n\n      const fieldAsyncErrors: (string | undefined)[] = rules\n        .reduce(\n          (errors: (string | undefined)[], validation: any) => (!validation.isValid\n            ? [...errors, validation.message]\n            : errors),\n          [],\n        );\n\n      setState((prevState: FieldState) => ({\n        ...prevState,\n        asyncErrors: fieldAsyncErrors,\n        isValidating: false,\n      }));\n    };\n\n    if (!debounceRef.current) {\n      validateField();\n      return () => {};\n    }\n\n    const timer = setTimeout(() => {\n      validateField();\n    }, debounceRef.current);\n    return () => clearTimeout(timer);\n  }, [\n    JSON.stringify(state.value),\n    JSON.stringify(\n      [\n        ...(validations || []),\n        ...(asyncValidations || []),\n      ]?.reduce<any>(\n        (acc, cur) => [\n          ...acc,\n          ...(cur.deps || []),\n          cur.message,\n        ],\n        [],\n      ),\n    ),\n  ]);\n\n  // Register / Unregister the field\n  useEffect(() => {\n    actions.registerField({\n      ...stateRef.current,\n      name: nameRef.current,\n      stepName: stepNameRef.current,\n      value: formatValueRef.current(stateRef.current.value),\n    });\n\n    return () => {\n      actions.unregisterField(\n        {\n          ...stateRef.current,\n          name: nameRef.current,\n          stepName: stepNameRef.current,\n          value: formatValueRef.current(stateRef.current.value),\n        },\n        keepValueRef.current,\n      );\n    };\n  }, []);\n\n  // Update field at form level\n  useEffect(() => {\n    actions.updateField({\n      ...state,\n      name,\n      stepName,\n      value: formatValueRef.current(state.value),\n    });\n  }, [name, stepName, JSON.stringify(state)]);\n\n  useEffect(() => () => {\n    isMountedRef.current = false;\n  }, []);\n\n  const isSubmitted = stepName && currentStep && currentStepName === stepName\n    ? currentStep.isSubmitted\n    : formState.isSubmitted;\n\n  const allErrors = [...state.externalErrors, ...state.asyncErrors, ...state.errors];\n\n  return {\n    errorMessage: allErrors[0],\n    errorMessages: allErrors,\n    id: getFieldHtmlUniqueId(formStateRef?.current?.id || '', name),\n    isPristine: state.isPristine,\n    isSubmitted,\n    isValid: !allErrors.length,\n    isValidating: state.isValidating,\n    setValue,\n    value: state.value,\n    valueDebounced: state.valueDebounced,\n    resetKey: state.resetKey,\n  };\n};\n","import {\n  useCallback, useState, useRef, useEffect,\n} from 'react';\nimport { Subscription } from 'rxjs';\nimport {\n  defaultFormState,\n  useFormContext,\n} from './Formiz';\nimport { getFormValues, useRefValue } from './utils';\nimport {\n  FormFields,\n  UseFormProps,\n  UseFormValues,\n} from './types/form.types';\n\nconst shouldSubscribe = (subscribe: UseFormProps['subscribe'], key: 'form' | 'fields') => {\n  if (subscribe === true) {\n    return true;\n  }\n\n  if (subscribe === key) {\n    return true;\n  }\n\n  if (typeof subscribe !== 'object') {\n    return false;\n  }\n\n  if (!subscribe[key]) {\n    return false;\n  }\n\n  return true;\n};\n\nexport const useForm = ({\n  subscribe = true,\n}: UseFormProps = {}): UseFormValues => {\n  const {\n    formStateRef, fieldsRef, formMethods, subjects,\n  } = useFormContext();\n  const [methods, setMethods] = useState(formMethods);\n  const [localFormState, setLocalFormState] = useState(formStateRef?.current ?? defaultFormState);\n  const [localFields, setLocalFields] = useState<FormFields>(fieldsRef?.current ?? []);\n  const localFieldsRef = useRefValue(localFields);\n  const subscriptionsRef = useRef<Array<Subscription>>([]);\n\n  const subscribeOnFormUpdate = (subject: any) => {\n    if (!subject || !shouldSubscribe(subscribe, 'form')) {\n      return;\n    }\n    const subscription = subject\n      .subscription\n      .subscribe(setLocalFormState);\n    subscriptionsRef.current.push(subscription);\n  };\n\n  const subscribeOnFieldsUpdate = (subject: any) => {\n    if (!subject || !shouldSubscribe(subscribe, 'fields')) {\n      return;\n    }\n\n    const subscribeFields = typeof subscribe === 'object' && typeof subscribe.fields === 'object' ? subscribe.fields : null;\n    const subscription = subject\n      .subscription\n      .subscribe((nextFields: FormFields) => {\n        const nextState = subscribeFields\n          ? nextFields.filter((x) => subscribeFields.includes(x.name))\n          : nextFields;\n\n        if (JSON.stringify(localFieldsRef.current) === JSON.stringify(nextState)) {\n          return;\n        }\n\n        setLocalFields(nextState);\n      });\n    subscriptionsRef.current.push(subscription);\n  };\n\n  // Use the connect property to retrieve the state\n  const connect = useCallback(({\n    formMethods: _formMethods,\n    subjects: _subjects,\n  }) => {\n    setMethods(_formMethods);\n    subscribeOnFormUpdate(_subjects?.onFormUpdate);\n    subscribeOnFieldsUpdate(_subjects?.onFieldsUpdate);\n  }, []);\n\n  // Subscribe (if not used with connect)\n  useEffect(() => {\n    subscribeOnFormUpdate(subjects?.onFormUpdate);\n    subscribeOnFieldsUpdate(subjects?.onFieldsUpdate);\n  }, []);\n\n  // Clear all subscriptions at unmount\n  useEffect(() => () => {\n    subscriptionsRef.current.forEach((subscription) => subscription?.unsubscribe());\n  }, []);\n\n  const enabledSteps = localFormState.steps\n    .filter((x) => x.isEnabled)\n    .map(({\n      name,\n      label,\n      isSubmitted,\n      isPristine,\n      isValidating,\n      isValid,\n      isVisited,\n    }, index) => ({\n      index,\n      name,\n      label,\n      isPristine: isPristine ?? false,\n      isSubmitted: isSubmitted ?? false,\n      isValid: isValid ?? false,\n      isValidating: isValidating ?? false,\n      isVisited: isVisited ?? false,\n    }))\n    .map((x, index) => ({ ...x, index }));\n\n  const currentStep = enabledSteps\n    .find((x) => x.name === (localFormState.navigatedStepName || localFormState.initialStepName))\n    || null;\n\n  return {\n    ...methods,\n    ...(shouldSubscribe(subscribe, 'form') ? {\n      resetKey: localFormState.resetKey,\n      isSubmitted: localFormState.isSubmitted,\n      isValid: localFormState.isValid,\n      isValidating: localFormState.isValidating,\n      isPristine: localFormState.isPristine,\n      steps: enabledSteps,\n      currentStep: currentStep || {},\n      isStepPristine: currentStep ? currentStep.isPristine : localFormState.isPristine,\n      isStepValid: currentStep ? currentStep.isValid : localFormState.isValid,\n      isStepValidating: currentStep ? currentStep.isValidating : localFormState.isValidating,\n      isStepSubmitted: currentStep ? currentStep.isSubmitted : localFormState.isSubmitted,\n      isFirstStep: enabledSteps[0]?.name === currentStep?.name,\n      isLastStep: enabledSteps[enabledSteps.length - 1]?.name === currentStep?.name,\n    } : {}),\n    ...(shouldSubscribe(subscribe, 'fields') ? {\n      values: getFormValues(localFields),\n    } : {}),\n    __connect__: connect,\n  };\n};\n"],"names":["isObject","x","constructor","Object","parseValues","values","keys","reduce","acc","key","parseValuesName","name","indexOf","value","nextValues","split","current","otherNames","isArraySyntax","match","currentName","currentIndex","currentCollection","length","group","join","getFormValues","fields","filter","field","isEnabled","obj","getFormUniqueId","Math","random","toString","substr","getFieldUniqueId","getFieldHtmlUniqueId","formId","fieldName","useRefValue","ref","useRef","useSubject","valueRef","throttle","subjectRef","Subject","push","next","subscription","pipe","throttleTime","undefined","leading","trailing","useBehaviorSubject","BehaviorSubject","updateStep","state","partialStepState","stepIndex","steps","findIndex","step","newStep","JSON","stringify","newSteps","orderedSteps","sort","a","b","order","enabledSteps","initialStepName","newState","unregisterStep","resetForm","resetKey","isSubmitted","isValid","navigatedStepName","map","isVisited","registerField","newField","find","id","otherFields","updateField","unregisterField","fieldId","setFieldsValues","objectOfValues","newFields","setFieldsExternalErrors","objectOfErrors","externalErrors","defaultFormState","isValidating","isPristine","FormContext","React","useFormContext","useContext","getCurrentStep","formState","currentStepName","Formiz","autoForm","children","connect","onChange","onSubmit","onValidSubmit","onInvalidSubmit","onValid","onInvalid","formStateRef","fieldsRef","keepValuesRef","connectRef","__connect__","onChangeRef","onSubmitRef","onValidSubmitRef","onInvalidSubmitRef","onValidRef","onInvalidRef","onFormUpdate","onFieldsUpdate","onExternalFieldsUpdate","onReset","checkFormValidity","every","errors","asyncErrors","checkStepValidity","stepName","checkFormPristine","checkStepPristine","checkFormValidating","some","checkStepValidating","updateFormState","stateToUpdate","goToStep","targetedStepIndex","nextStep","isLastStep","prevStep","isFirstStep","submit","e","preventDefault","formatedValues","submitStep","currentStep","fieldsActions","invalidateFields","getFieldStepName","validateForm","formActions","shouldKeepValue","reset","formMethods","contextValue","actions","subjects","useEffect","Provider","noValidate","ErrorFieldWithoutForm","Error","ErrorFieldWithoutName","ErrorStepWithoutForm","ErrorStepWithoutName","StepContext","useStepContext","FormizStep","as","Tag","label","style","rest","useState","setFormState","setState","isActive","subscribe","unsubscribe","prevState","display","fieldPropTypes","PropTypes","string","isRequired","debounce","number","defaultValue","any","formatValue","func","required","oneOfType","bool","node","validations","arrayOf","shape","rule","message","deps","asyncValidations","keepValue","fieldDefaultProps","val","getValidationsWithRequired","useField","isMountedRef","stepContext","initValue","valueDebounced","stateRef","nameRef","stepNameRef","validationsRef","asyncValidationsRef","debounceRef","formatValueRef","defaultValueRef","keepValueRef","setValue","error","validateField","fieldErrors","validation","shouldRunAsyncValidations","Promise","all","rules","fieldAsyncErrors","timer","setTimeout","clearTimeout","cur","allErrors","errorMessage","errorMessages","shouldSubscribe","useForm","methods","setMethods","localFormState","setLocalFormState","localFields","setLocalFields","localFieldsRef","subscriptionsRef","subscribeOnFormUpdate","subject","subscribeOnFieldsUpdate","subscribeFields","nextFields","nextState","includes","useCallback","_formMethods","_subjects","forEach","index","isStepPristine","isStepValid","isStepValidating","isStepSubmitted"],"mappings":"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"}