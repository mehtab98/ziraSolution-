{"version":3,"file":"formiz-core.cjs.development.js","sources":["../src/utils/form.utils.ts","../src/utils/global.utils.ts","../src/utils/useRefValue.ts","../src/utils/useSubject.ts","../src/formActions.ts","../src/fieldsActions.ts","../src/Formiz.tsx","../src/errors/index.ts","../src/FormizStep.tsx","../src/types/field.types.ts","../src/useField.ts","../src/useForm.ts"],"sourcesContent":["import { FormFields } from '../types/form.types';\n\nconst isObject = (x: any) => x && typeof x === 'object' && x.constructor === Object;\n\nconst parseValues = (values: any) => Object.keys(values)\n  .reduce(\n    (acc, key) => parseValuesName(key, acc), // eslint-disable-line\n    values,\n  );\n\nconst parseValuesName = (name: any, values: any): any => {\n  if (name.indexOf('.') < 0 && name.indexOf('[') < 0) {\n    return values;\n  }\n\n  const value = values[name];\n  const { [name]: deletedKey, ...nextValues } = values || {};\n  const [current, ...otherNames] = name.split('.');\n  const isArraySyntax = current.match(/\\[([0-9]*)\\]$/g);\n\n  if (isArraySyntax) {\n    const [currentName,, currentIndex] = current.split(/(\\[|\\])/g);\n    const currentCollection = values[currentName] || [];\n\n    if (otherNames.length) {\n      const group = {\n        ...(values[currentName] && isObject(values[currentName][currentIndex])\n          ? values[currentName][currentIndex]\n          : {}\n        ),\n        [otherNames.join('.')]: value,\n      };\n\n      currentCollection[currentIndex] = parseValues(group);\n    } else {\n      currentCollection[currentIndex] = value;\n    }\n\n    return {\n      ...nextValues,\n      [currentName]: currentCollection,\n    };\n  }\n\n  const group = {\n    ...(isObject(values[current]) ? values[current] : {}),\n    [otherNames.join('.')]: value,\n  };\n\n  return {\n    ...nextValues,\n    [current]: parseValues(group),\n  };\n};\n\nexport const getFormValues = (fields: FormFields) => {\n  const values = (fields || [])\n    .filter((field) => field.isEnabled)\n    .reduce((obj, field) => ({\n      ...obj,\n      [field.name]: field.value,\n    }), {});\n\n  return parseValues(values);\n};\n","export const getFormUniqueId = (): string => `form-${Math.random().toString(36).substr(2, 9)}`;\nexport const getFieldUniqueId = (): string => `field-${Math.random().toString(36).substr(2, 9)}`;\nexport const getFieldHtmlUniqueId = (formId: string, fieldName: string): string => `formiz-${formId}-field-${fieldName}`;\n","import { useRef } from 'react';\n\nexport const useRefValue = (value: any): React.RefObject<any> => {\n  const ref = useRef(value);\n  ref.current = value;\n  return ref;\n};\n","import React, { useRef } from 'react';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { throttleTime } from 'rxjs/operators';\n\nexport const useSubject = (valueRef: React.RefObject<any>, throttle = 100) => {\n  const subjectRef = useRef(new Subject());\n  const push = (value?: any) => {\n    subjectRef.current.next(value ?? valueRef.current);\n  };\n\n  const subscription = subjectRef.current\n    .pipe(throttleTime(throttle, undefined, { leading: true, trailing: true }));\n\n  return { push, subscription };\n};\n\n\nexport const useBehaviorSubject = (valueRef: React.RefObject<any>, throttle = 100) => {\n  const subjectRef = useRef(new BehaviorSubject(valueRef.current));\n  const push = (value?: any) => {\n    subjectRef.current.next(value ?? valueRef.current);\n  };\n\n  const subscription = subjectRef.current\n    .pipe(throttleTime(throttle, undefined, { leading: true, trailing: true }));\n\n  return { push, subscription };\n};\n","import { FormState } from './types/form.types';\nimport { StepState } from './types/step.types';\n\nexport const updateStep = (state: FormState, partialStepState: Partial<StepState>): FormState => {\n  if (!partialStepState || !partialStepState.name) return state;\n\n  const stepIndex = state.steps.findIndex((x: StepState) => x.name === partialStepState.name);\n  const step = state.steps[stepIndex];\n\n  const newStep: StepState = {\n    ...(step || {}),\n    ...partialStepState,\n  };\n\n  if (JSON.stringify(newStep) === JSON.stringify(step)) {\n    return state;\n  }\n\n  const newSteps = [...state.steps];\n\n  if (!step) {\n    newSteps.push(newStep);\n  } else {\n    newSteps[stepIndex] = newStep;\n  }\n\n  const orderedSteps = newSteps\n    .sort((a, b) => a.order - b.order);\n\n  const enabledSteps = orderedSteps.filter(({ isEnabled }) => isEnabled);\n\n  const initialStepName = enabledSteps.length ? enabledSteps[0].name : null;\n\n  const newState = {\n    ...state,\n    initialStepName,\n    steps: orderedSteps,\n  };\n\n  return newState;\n};\n\nexport const unregisterStep = (state: FormState, name: string): FormState => {\n  if (!name) return state;\n  const newState = {\n    ...state,\n    steps: state.steps.filter((x) => x.name !== name),\n  };\n  return newState;\n};\n\nexport const resetForm = (state: FormState): FormState => {\n  const newState = {\n    ...state,\n    resetKey: state.resetKey + 1,\n    isSubmitted: false,\n    isValid: true,\n    navigatedStepName: null,\n    steps: state.steps.map((step) => ({\n      ...step,\n      isSubmitted: false,\n      isVisited: false,\n    })),\n  };\n  return newState;\n};\n","import { FormFields } from './types/form.types';\nimport { Field } from './types/field.types';\n\nexport const registerField = (\n  fields: FormFields,\n  newField: Field,\n): FormFields => {\n  if (!newField) return fields;\n\n  const field = fields.find((x: Field) => x.id === newField.id);\n  const otherFields = fields.filter((x: Field) => x.id !== newField.id);\n\n  if (JSON.stringify(newField) === JSON.stringify(field)) {\n    return fields;\n  }\n\n  return [\n    ...otherFields,\n    { ...newField },\n  ];\n};\n\n\nexport const updateField = (\n  fields: FormFields,\n  newField: Field,\n): FormFields => {\n  if (!newField) return fields;\n\n  const field = fields.find((x: Field) => x.id === newField.id);\n  const otherFields = fields.filter((x: Field) => x.id !== newField.id);\n\n  if (JSON.stringify(newField) === JSON.stringify(field)) {\n    return fields;\n  }\n\n  return [\n    ...otherFields,\n    {\n      ...newField,\n    },\n  ];\n};\n\nexport const unregisterField = (\n  fields: FormFields,\n  fieldId: Field['id'],\n): FormFields => {\n  if (!fieldId) return fields;\n  const otherFields = fields.filter((x: Field) => x.id !== fieldId);\n  return [...otherFields];\n};\n\nexport const setFieldsValues = (\n  fields: FormFields,\n  objectOfValues: any = {},\n): FormFields => {\n  if (!objectOfValues) return fields;\n\n  const newFields = fields.map((field: Field) => ({\n    ...field,\n    value: objectOfValues[field.name] ?? field.value,\n  }));\n\n  return [...newFields];\n};\n\nexport const setFieldsExternalErrors = (\n  fields: FormFields,\n  objectOfErrors: any = {},\n): FormFields => {\n  if (!objectOfErrors) return fields;\n\n  const newFields = fields.map((field: Field) => ({\n    ...field,\n    externalErrors: objectOfErrors[field.name]\n      ? [objectOfErrors[field.name], field.externalErrors]\n      : field.externalErrors,\n  }));\n\n  return [...newFields];\n};\n","import * as React from 'react';\nimport {\n  useEffect, useRef, useContext,\n} from 'react';\nimport { Field } from './types/field.types';\nimport {\n  useRefValue, getFormValues, useSubject, useBehaviorSubject, getFormUniqueId,\n} from './utils';\nimport {\n  FormMethods, FormState, FormContextValue, FormizProps, FormFields, KeepValues,\n} from './types/form.types';\nimport { StepState } from './types/step.types';\nimport * as formActions from './formActions';\nimport * as fieldsActions from './fieldsActions';\n\nexport const defaultFormActions: FormMethods = {\n  submit: () => {},\n  setFieldsValues: () => {},\n};\n\nexport const defaultFormState: FormState = {\n  id: getFormUniqueId(),\n  resetKey: 0,\n  isSubmitted: false,\n  isValidating: false,\n  isValid: true,\n  isPristine: true,\n  steps: [],\n  initialStepName: null,\n  navigatedStepName: null,\n};\n\nexport const FormContext = React.createContext<FormContextValue>({});\nexport const useFormContext = () => useContext(FormContext);\n\nconst getCurrentStep = (formState: FormState) => {\n  const currentStepName = formState.navigatedStepName\n    || formState.initialStepName;\n  return formState.steps\n    .find((x) => x.name === currentStepName);\n};\n\nexport const Formiz = ({\n  autoForm = false,\n  children = '',\n  connect = {},\n  id = getFormUniqueId(),\n  onChange = () => {},\n  onSubmit = () => {},\n  onValidSubmit = () => {},\n  onInvalidSubmit = () => {},\n  onValid = () => {},\n  onInvalid = () => {},\n}: FormizProps) => {\n  const formStateRef = useRef<FormState>({\n    ...defaultFormState,\n    id,\n  });\n  const fieldsRef = useRef<FormFields>([]);\n  const keepValuesRef = useRef<KeepValues>({});\n  const connectRef = useRefValue(connect.__connect__ || (() => {}));\n  const onChangeRef = useRefValue(onChange);\n  const onSubmitRef = useRefValue(onSubmit);\n  const onValidSubmitRef = useRefValue(onValidSubmit);\n  const onInvalidSubmitRef = useRefValue(onInvalidSubmit);\n  const onValidRef = useRefValue(onValid);\n  const onInvalidRef = useRefValue(onInvalid);\n\n  const onFormUpdate = useBehaviorSubject(formStateRef);\n  const onFieldsUpdate = useBehaviorSubject(fieldsRef);\n  const onExternalFieldsUpdate = useSubject(fieldsRef);\n  const onReset = useSubject(formStateRef);\n\n  const checkFormValidity = (): boolean => {\n    const isValid = fieldsRef.current\n      .every((field: any) => (\n        !field?.errors?.length\n        && !field?.asyncErrors?.length\n        && !field?.externalErrors?.length\n      ));\n\n    if (isValid) {\n      onValidRef.current();\n    } else {\n      onInvalidRef.current();\n    }\n\n    return isValid;\n  };\n\n  const checkStepValidity = (stepName: string): boolean => fieldsRef.current\n    .filter((field) => field.stepName === stepName)\n    .every((field: any) => (\n      !field?.errors?.length\n      && !field?.asyncErrors?.length\n      && !field?.externalErrors?.length\n    ));\n\n  const checkFormPristine = (): boolean => fieldsRef.current\n    .every((field: any) => field?.isPristine);\n\n  const checkStepPristine = (stepName: string): boolean => fieldsRef.current\n    .filter((field) => field.stepName === stepName)\n    .every((field: any) => field?.isPristine);\n\n  const checkFormValidating = (): boolean => fieldsRef.current\n    .some((field: any) => field?.isValidating);\n\n  const checkStepValidating = (stepName: string): boolean => fieldsRef.current\n    .filter((field) => field.stepName === stepName)\n    .some((field: any) => field?.isValidating);\n\n  const updateFormState = (stateToUpdate: Partial<FormState>): void => {\n    const newState = { ...formStateRef.current, ...stateToUpdate };\n    if (JSON.stringify(newState) === JSON.stringify(formStateRef.current)) {\n      return;\n    }\n    formStateRef.current = newState;\n    onFormUpdate.push();\n  };\n\n  const goToStep = (stepName: string) => {\n    const enabledSteps = formStateRef.current.steps\n      .filter(({ isEnabled }) => isEnabled);\n    const targetedStepIndex = enabledSteps\n      .findIndex(({ name }) => name === stepName);\n\n    if (targetedStepIndex < 0) {\n      return;\n    }\n\n    updateFormState({\n      navigatedStepName: enabledSteps[targetedStepIndex].name,\n    });\n  };\n\n  const nextStep = () => {\n    const enabledSteps = formStateRef.current.steps.filter((x) => x.isEnabled);\n    const stepIndex = enabledSteps\n      .findIndex((step) => step.name === getCurrentStep(formStateRef.current)?.name);\n    const isLastStep = stepIndex === enabledSteps.length - 1;\n\n    if (isLastStep) {\n      return;\n    }\n\n    goToStep(enabledSteps[stepIndex + 1].name);\n  };\n\n  const prevStep = () => {\n    const enabledSteps = formStateRef.current.steps.filter((x) => x.isEnabled);\n    const stepIndex = enabledSteps\n      .findIndex((step) => step.name === getCurrentStep(formStateRef.current)?.name);\n    const isFirstStep = stepIndex === 0;\n\n    if (isFirstStep) {\n      return;\n    }\n\n    goToStep(enabledSteps[stepIndex - 1].name);\n  };\n\n  const submit = (e?: React.FormEvent<HTMLFormElement>) => {\n    if (e) e.preventDefault();\n\n    const { steps } = formStateRef.current;\n    updateFormState({\n      isSubmitted: true,\n      steps: steps.map((step) => ({ ...step, isSubmitted: true })),\n    });\n\n    const formatedValues = getFormValues(fieldsRef.current);\n\n    if (formStateRef.current.isValid && !formStateRef.current.isValidating) {\n      onValidSubmitRef.current(formatedValues);\n    } else {\n      onInvalidSubmitRef.current(formatedValues);\n    }\n\n    onSubmitRef.current(formatedValues);\n  };\n\n  const submitStep = (e?: React.FormEvent<HTMLFormElement>) => {\n    if (e) e.preventDefault();\n\n    updateFormState({\n      steps: formStateRef.current.steps.map((step) => ({\n        ...step,\n        isSubmitted: step.name === getCurrentStep(formStateRef.current)?.name\n          ? true\n          : step.isSubmitted,\n      })),\n    });\n\n    const currentStep = getCurrentStep(formStateRef.current);\n\n    if (!currentStep?.isValid || currentStep?.isValidating) {\n      return;\n    }\n\n    const enabledSteps = formStateRef.current.steps.filter((x) => x.isEnabled);\n    const currentStepName = getCurrentStep(formStateRef.current)?.name;\n    const isLastStep = enabledSteps[enabledSteps.length - 1]?.name === currentStepName;\n\n    if (isLastStep) {\n      submit();\n      return;\n    }\n\n    nextStep();\n  };\n\n  const setFieldsValues = (objectOfValues = {}) => {\n    fieldsRef.current = fieldsActions.setFieldsValues(fieldsRef.current, objectOfValues);\n    onExternalFieldsUpdate.push();\n  };\n\n  const invalidateFields = (objectOfErrors = {}) => {\n    fieldsRef.current = fieldsActions.setFieldsExternalErrors(fieldsRef.current, objectOfErrors);\n    onExternalFieldsUpdate.push();\n  };\n\n  const getFieldStepName = (fieldName: string) => fieldsRef.current\n    .find((field: Field) => fieldName === field.name)?.stepName ?? null;\n\n  const validateForm = () => {\n    updateFormState({\n      isValid: checkFormValidity(),\n      isPristine: checkFormPristine(),\n      isValidating: checkFormValidating(),\n      steps: formStateRef.current.steps.map((step) => ({\n        ...step,\n        isValid: checkStepValidity(step.name),\n        isPristine: checkStepPristine(step.name),\n        isValidating: checkStepValidating(step.name),\n      })),\n    });\n  };\n\n  const updateStep = (step: Partial<StepState>): void => {\n    updateFormState(formActions.updateStep(formStateRef.current, step));\n    validateForm();\n  };\n\n  const unregisterStep = (name: string): void => {\n    updateFormState({\n      ...formActions.unregisterStep(formStateRef.current, name),\n      isValid: checkFormValidity(),\n    });\n    validateForm();\n  };\n\n  const registerField = (field: Field): void => {\n    delete keepValuesRef.current[field.name];\n    fieldsRef.current = fieldsActions.registerField(fieldsRef.current, field);\n    onFieldsUpdate.push();\n    onChangeRef.current(getFormValues(fieldsRef.current));\n    validateForm();\n  };\n\n  const updateField = (field: Field): void => {\n    fieldsRef.current = fieldsActions.updateField(fieldsRef.current, field);\n    onFieldsUpdate.push();\n    onChangeRef.current(getFormValues(fieldsRef.current));\n    validateForm();\n  };\n\n  const unregisterField = (field: Field, shouldKeepValue: boolean): void => {\n    if (shouldKeepValue) {\n      keepValuesRef.current[field.name] = field.value;\n    }\n    fieldsRef.current = fieldsActions.unregisterField(fieldsRef.current, field.id);\n    onFieldsUpdate.push();\n    onChangeRef.current(getFormValues(fieldsRef.current));\n    validateForm();\n  };\n\n  const reset = (): void => {\n    updateFormState(formActions.resetForm(formStateRef.current));\n    keepValuesRef.current = {};\n    onReset.push();\n  };\n\n  const formMethods: FormMethods = {\n    submit,\n    submitStep,\n    setFieldsValues,\n    invalidateFields,\n    getFieldStepName,\n    goToStep,\n    nextStep,\n    prevStep,\n    reset,\n  };\n\n  const contextValue: FormContextValue = {\n    formStateRef,\n    fieldsRef,\n    actions: {\n      updateStep,\n      unregisterStep,\n      registerField,\n      updateField,\n      unregisterField,\n    },\n    formMethods,\n    keepValuesRef,\n    subjects: {\n      onFormUpdate,\n      onFieldsUpdate,\n      onExternalFieldsUpdate,\n      onReset,\n    },\n  };\n\n  // Connect\n  useEffect(() => {\n    connectRef.current(contextValue);\n  }, []);\n\n  return (\n    <FormContext.Provider value={contextValue}>\n      {!autoForm\n        ? children\n        : (\n          <form noValidate onSubmit={submit}>\n            {children}\n          </form>\n        )}\n    </FormContext.Provider>\n  );\n};\n","// Fields errors\nexport const ErrorFieldWithoutForm = new Error('A Formiz field always needs to be a children of a `<Formiz>` component.');\nexport const ErrorFieldWithoutName = new Error('A Formiz field (component using a useField hook) always needs a `name` props.');\n\n// Steps errors\nexport const ErrorStepWithoutForm = new Error('A <FormizStep> always needs to be a children of a `<Formiz>` component.');\nexport const ErrorStepWithoutName = new Error('A <FormizStep> always needs a `name` props.');\n","import * as React from 'react';\nimport {\n  useContext, useEffect, useState,\n} from 'react';\nimport { FormizStepProps, StepState } from './types/step.types';\nimport { ErrorStepWithoutName, ErrorStepWithoutForm } from './errors';\nimport { useFormContext, defaultFormState } from './Formiz';\n\nexport const StepContext = React.createContext<any>({});\nexport const useStepContext = () => useContext(StepContext);\n\nexport const FormizStep = ({\n  as: Tag = 'div',\n  children,\n  name,\n  label,\n  order,\n  isEnabled = true,\n  style = {},\n  ...rest\n}: FormizStepProps) => {\n  if (!name) {\n    throw ErrorStepWithoutName;\n  }\n\n  const {\n    formStateRef,\n    actions,\n    subjects,\n  } = useFormContext();\n\n  if (!subjects || !actions) {\n    throw ErrorStepWithoutForm;\n  }\n\n  const [formState, setFormState] = useState(formStateRef?.current ?? defaultFormState);\n  const [state, setState] = useState<Partial<StepState>>({\n    name,\n    label,\n    isVisited: false,\n    order: order ?? 0,\n  });\n  const isActive = formState.navigatedStepName\n    ? formState.navigatedStepName === name\n    : formState.initialStepName === name;\n\n  // Subscribe to form state\n  useEffect(() => {\n    const subscription = subjects.onFormUpdate\n      .subscription\n      .subscribe(setFormState);\n    return () => subscription.unsubscribe();\n  }, []);\n\n  useEffect(() => {\n    if (formState.navigatedStepName === name && !state.isVisited && isActive) {\n      setState((prevState) => ({ ...prevState, isVisited: true }));\n    }\n  });\n\n  // Register / Update the step\n  useEffect(() => {\n    actions.updateStep({\n      ...state,\n      isEnabled,\n    });\n  }, [state, isEnabled]);\n\n  // Unregister the step\n  useEffect(() => () => {\n    actions.unregisterStep(name);\n  }, [name]);\n\n  if (!isEnabled) {\n    return null;\n  }\n\n  return (\n    <StepContext.Provider value={{\n      name,\n    }}\n    >\n      <Tag\n        style={{\n          ...style,\n          display: !isActive ? 'none' : null,\n        }}\n        {...rest}\n      >\n        {isEnabled && children}\n      </Tag>\n    </StepContext.Provider>\n  );\n};\n","import PropTypes from 'prop-types';\n\nexport type FieldValue = any; // eslint-disable-line\n\nexport interface FieldValidationObject {\n  rule(value: FieldValue): boolean;\n  message?: string;\n  deps?: any[];\n}\nexport interface FieldAsyncValidationObject {\n  rule(value: FieldValue): Promise<boolean>;\n  message?: string;\n  deps?: any[];\n}\n\nexport interface UseFieldProps {\n  name: string;\n  debounce?: number;\n  defaultValue?: FieldValue;\n  formatValue?(value: FieldValue): FieldValue;\n  onChange?(value: FieldValue, rawValue: FieldValue): void;\n  required?: boolean;\n  validations?: FieldValidationObject[];\n  asyncValidations?: FieldAsyncValidationObject[];\n  keepValue?: boolean;\n}\n\nexport const fieldPropTypes = {\n  name: PropTypes.string.isRequired,\n  debounce: PropTypes.number,\n  defaultValue: PropTypes.any,\n  formatValue: PropTypes.func,\n  onChange: PropTypes.func,\n  required: PropTypes.oneOfType([PropTypes.bool, PropTypes.node]),\n  validations: PropTypes.arrayOf(PropTypes.shape({\n    rule: PropTypes.func,\n    message: PropTypes.node,\n    deps: PropTypes.arrayOf(PropTypes.any),\n  })),\n  asyncValidations: PropTypes.arrayOf(PropTypes.shape({\n    rule: PropTypes.func,\n    message: PropTypes.node,\n    deps: PropTypes.arrayOf(PropTypes.any),\n  })),\n  keepValue: PropTypes.bool,\n};\n\nexport const fieldDefaultProps: Omit<UseFieldProps, 'name'> = {\n  debounce: 100,\n  defaultValue: null,\n  formatValue: (val: FieldValue): FieldValue => val,\n  onChange: () => {},\n  required: false,\n  validations: [],\n  asyncValidations: [],\n  keepValue: false,\n};\n\nexport interface Field {\n  id: string;\n  resetKey: number;\n  name: string;\n  errors: (string | undefined)[];\n  asyncErrors: (string | undefined)[];\n  externalErrors: string[];\n  value: FieldValue;\n  valueDebounced: FieldValue;\n  isValidating: boolean;\n  isPristine: boolean;\n  isEnabled: boolean;\n  stepName?: string;\n}\n\nexport interface FieldState {\n  id: string;\n  resetKey: number;\n  errors: (string | undefined)[];\n  asyncErrors: (string | undefined)[];\n  externalErrors: string[];\n  value: FieldValue;\n  valueDebounced: FieldValue;\n  isValidating: boolean;\n  isPristine: boolean;\n  isEnabled: boolean;\n}\n\nexport interface UseFieldValues {\n  errorMessage?: string | undefined;\n  errorMessages?: (string | undefined)[];\n  id: string;\n  isPristine: boolean;\n  isSubmitted: boolean;\n  isValid: boolean;\n  isValidating: boolean;\n  setValue(value: FieldValue): void;\n  value: FieldValue;\n  valueDebounced: FieldValue;\n  resetKey: number;\n}\n","import {\n  useState, useEffect, useRef,\n} from 'react';\nimport {\n  FieldValue,\n  UseFieldProps,\n  UseFieldValues,\n  FieldState,\n  FieldValidationObject,\n  FieldAsyncValidationObject,\n  fieldDefaultProps,\n} from './types/field.types';\nimport { FormFields } from './types/form.types';\nimport { StepState } from './types/step.types';\nimport { ErrorFieldWithoutForm, ErrorFieldWithoutName } from './errors';\nimport { getFieldUniqueId, useRefValue, getFieldHtmlUniqueId } from './utils';\nimport { useFormContext, defaultFormState } from './Formiz';\nimport { useStepContext } from './FormizStep';\n\nconst getValidationsWithRequired = (\n  validations: FieldValidationObject[],\n  required?: boolean | string,\n) => {\n  if (!required && required !== '') {\n    return validations;\n  }\n  return [\n    ...validations,\n    {\n      rule: (x: FieldValue) => !!x || x === 0,\n      message: required !== true ? required : '',\n    }];\n};\n\nexport const useField = ({\n  name,\n  debounce = fieldDefaultProps.debounce,\n  defaultValue = fieldDefaultProps.defaultValue,\n  formatValue = fieldDefaultProps.formatValue,\n  onChange = fieldDefaultProps.onChange,\n  required = fieldDefaultProps.required,\n  validations = fieldDefaultProps.validations,\n  asyncValidations = fieldDefaultProps.asyncValidations,\n  keepValue = fieldDefaultProps.keepValue,\n}: UseFieldProps): UseFieldValues => {\n  if (!name) {\n    throw ErrorFieldWithoutName;\n  }\n\n  const {\n    formStateRef,\n    actions,\n    subjects,\n    keepValuesRef,\n  } = useFormContext();\n\n  if (!subjects || !actions || !keepValuesRef) {\n    throw ErrorFieldWithoutForm;\n  }\n\n  const isMountedRef = useRef(true);\n  const stepContext = useStepContext();\n  const stepName = stepContext?.name;\n\n  const [formState, setFormState] = useState(formStateRef?.current ?? defaultFormState);\n  const initValue = keepValuesRef.current?.[name] ?? defaultValue;\n  const [state, setState] = useState<FieldState>({\n    id: getFieldUniqueId(),\n    resetKey: 0,\n    value: initValue,\n    valueDebounced: initValue,\n    errors: [],\n    asyncErrors: [],\n    externalErrors: [],\n    isValidating: false,\n    isPristine: true,\n    isEnabled: true,\n  });\n  const stateRef = useRefValue(state);\n  const nameRef = useRefValue(name);\n  const stepNameRef = useRefValue(stepName);\n  const validationsRef = useRefValue(getValidationsWithRequired(validations || [], required));\n  const asyncValidationsRef = useRefValue(asyncValidations || []);\n  const debounceRef = useRefValue(debounce);\n  const onChangeRef = useRefValue(onChange);\n  const formatValueRef = useRefValue(formatValue);\n  const defaultValueRef = useRefValue(defaultValue);\n  const keepValueRef = useRefValue(keepValue);\n  const currentStepName = formState.navigatedStepName\n    || formState.initialStepName;\n  const currentStep: (StepState | null) = formState.steps\n    .find((x) => x.name === currentStepName) || null;\n\n  const setValue = (value: FieldValue) => {\n    setState((prevState: FieldState) => ({\n      ...prevState,\n      externalErrors: [],\n      value,\n      isPristine: false,\n    }));\n    onChangeRef.current(formatValueRef.current(value), value);\n  };\n\n  // Subscribe to form state\n  useEffect(() => {\n    const subscription = subjects.onFormUpdate\n      .subscription\n      .subscribe(setFormState);\n    return () => subscription.unsubscribe();\n  }, []);\n\n  // Subscribe to external updates\n  useEffect(() => {\n    const subscription = subjects.onExternalFieldsUpdate\n      .subscription\n      .subscribe((fields: FormFields) => {\n        const field = fields.find((x) => x.id === stateRef.current.id);\n        if (field && JSON.stringify(field) !== JSON.stringify(stateRef.current)) {\n          setState(field);\n        }\n      });\n    return () => subscription.unsubscribe();\n  }, []);\n\n  // Subscribe to reset\n  useEffect(() => {\n    const subscription = subjects.onReset\n      .subscription\n      .subscribe(() => {\n        setState((prevState) => ({\n          ...prevState,\n          error: [],\n          externalErrors: [],\n          resetKey: prevState.resetKey + 1,\n          isPristine: true,\n          value: defaultValueRef.current,\n        }));\n        onChangeRef.current(\n          formatValueRef.current(defaultValueRef.current),\n          defaultValueRef.current,\n        );\n      });\n    return () => subscription.unsubscribe();\n  }, []);\n\n\n  // Update validations\n  useEffect(() => {\n    const validateField = async () => {\n      /**\n       * Sync validations\n       */\n\n      const fieldErrors = (validationsRef.current || [])\n        .reduce(\n          (errors: any, validation: FieldValidationObject) => (!validation.rule(state.value)\n            ? [...errors, validation.message]\n            : errors),\n          [],\n        );\n\n      const shouldRunAsyncValidations = (\n        !fieldErrors.length\n        && !!(asyncValidationsRef.current || []).length\n      );\n\n      setState((prevState: FieldState) => ({\n        ...prevState,\n        errors: fieldErrors,\n        asyncErrors: [],\n        valueDebounced: prevState.value,\n        isValidating: shouldRunAsyncValidations,\n      }));\n\n      if (!shouldRunAsyncValidations) {\n        return;\n      }\n\n      /**\n       * Async validations\n       */\n\n      const rules = await Promise.all((asyncValidationsRef.current || [])\n        .map(async (validation: FieldAsyncValidationObject) => {\n          const isValid = await validation.rule(state.value);\n          return {\n            ...validation,\n            isValid,\n          };\n        }));\n\n      if (\n        !isMountedRef.current\n        || state.value !== stateRef.current.value\n      ) {\n        return;\n      }\n\n      const fieldAsyncErrors: (string | undefined)[] = rules\n        .reduce(\n          (errors: (string | undefined)[], validation: any) => (!validation.isValid\n            ? [...errors, validation.message]\n            : errors),\n          [],\n        );\n\n      setState((prevState: FieldState) => ({\n        ...prevState,\n        asyncErrors: fieldAsyncErrors,\n        isValidating: false,\n      }));\n    };\n\n    if (!debounceRef.current) {\n      validateField();\n      return () => {};\n    }\n\n    const timer = setTimeout(() => {\n      validateField();\n    }, debounceRef.current);\n    return () => clearTimeout(timer);\n  }, [\n    JSON.stringify(state.value),\n    JSON.stringify(\n      [\n        ...(validations || []),\n        ...(asyncValidations || []),\n      ]?.reduce<any>(\n        (acc, cur) => [\n          ...acc,\n          ...(cur.deps || []),\n          cur.message,\n        ],\n        [],\n      ),\n    ),\n  ]);\n\n  // Register / Unregister the field\n  useEffect(() => {\n    actions.registerField({\n      ...stateRef.current,\n      name: nameRef.current,\n      stepName: stepNameRef.current,\n      value: formatValueRef.current(stateRef.current.value),\n    });\n\n    return () => {\n      actions.unregisterField(\n        {\n          ...stateRef.current,\n          name: nameRef.current,\n          stepName: stepNameRef.current,\n          value: formatValueRef.current(stateRef.current.value),\n        },\n        keepValueRef.current,\n      );\n    };\n  }, []);\n\n  // Update field at form level\n  useEffect(() => {\n    actions.updateField({\n      ...state,\n      name,\n      stepName,\n      value: formatValueRef.current(state.value),\n    });\n  }, [name, stepName, JSON.stringify(state)]);\n\n  useEffect(() => () => {\n    isMountedRef.current = false;\n  }, []);\n\n  const isSubmitted = stepName && currentStep && currentStepName === stepName\n    ? currentStep.isSubmitted\n    : formState.isSubmitted;\n\n  const allErrors = [...state.externalErrors, ...state.asyncErrors, ...state.errors];\n\n  return {\n    errorMessage: allErrors[0],\n    errorMessages: allErrors,\n    id: getFieldHtmlUniqueId(formStateRef?.current?.id || '', name),\n    isPristine: state.isPristine,\n    isSubmitted,\n    isValid: !allErrors.length,\n    isValidating: state.isValidating,\n    setValue,\n    value: state.value,\n    valueDebounced: state.valueDebounced,\n    resetKey: state.resetKey,\n  };\n};\n","import {\n  useCallback, useState, useRef, useEffect,\n} from 'react';\nimport { Subscription } from 'rxjs';\nimport {\n  defaultFormState,\n  useFormContext,\n} from './Formiz';\nimport { getFormValues, useRefValue } from './utils';\nimport {\n  FormFields,\n  UseFormProps,\n  UseFormValues,\n} from './types/form.types';\n\nconst shouldSubscribe = (subscribe: UseFormProps['subscribe'], key: 'form' | 'fields') => {\n  if (subscribe === true) {\n    return true;\n  }\n\n  if (subscribe === key) {\n    return true;\n  }\n\n  if (typeof subscribe !== 'object') {\n    return false;\n  }\n\n  if (!subscribe[key]) {\n    return false;\n  }\n\n  return true;\n};\n\nexport const useForm = ({\n  subscribe = true,\n}: UseFormProps = {}): UseFormValues => {\n  const {\n    formStateRef, fieldsRef, formMethods, subjects,\n  } = useFormContext();\n  const [methods, setMethods] = useState(formMethods);\n  const [localFormState, setLocalFormState] = useState(formStateRef?.current ?? defaultFormState);\n  const [localFields, setLocalFields] = useState<FormFields>(fieldsRef?.current ?? []);\n  const localFieldsRef = useRefValue(localFields);\n  const subscriptionsRef = useRef<Array<Subscription>>([]);\n\n  const subscribeOnFormUpdate = (subject: any) => {\n    if (!subject || !shouldSubscribe(subscribe, 'form')) {\n      return;\n    }\n    const subscription = subject\n      .subscription\n      .subscribe(setLocalFormState);\n    subscriptionsRef.current.push(subscription);\n  };\n\n  const subscribeOnFieldsUpdate = (subject: any) => {\n    if (!subject || !shouldSubscribe(subscribe, 'fields')) {\n      return;\n    }\n\n    const subscribeFields = typeof subscribe === 'object' && typeof subscribe.fields === 'object' ? subscribe.fields : null;\n    const subscription = subject\n      .subscription\n      .subscribe((nextFields: FormFields) => {\n        const nextState = subscribeFields\n          ? nextFields.filter((x) => subscribeFields.includes(x.name))\n          : nextFields;\n\n        if (JSON.stringify(localFieldsRef.current) === JSON.stringify(nextState)) {\n          return;\n        }\n\n        setLocalFields(nextState);\n      });\n    subscriptionsRef.current.push(subscription);\n  };\n\n  // Use the connect property to retrieve the state\n  const connect = useCallback(({\n    formMethods: _formMethods,\n    subjects: _subjects,\n  }) => {\n    setMethods(_formMethods);\n    subscribeOnFormUpdate(_subjects?.onFormUpdate);\n    subscribeOnFieldsUpdate(_subjects?.onFieldsUpdate);\n  }, []);\n\n  // Subscribe (if not used with connect)\n  useEffect(() => {\n    subscribeOnFormUpdate(subjects?.onFormUpdate);\n    subscribeOnFieldsUpdate(subjects?.onFieldsUpdate);\n  }, []);\n\n  // Clear all subscriptions at unmount\n  useEffect(() => () => {\n    subscriptionsRef.current.forEach((subscription) => subscription?.unsubscribe());\n  }, []);\n\n  const enabledSteps = localFormState.steps\n    .filter((x) => x.isEnabled)\n    .map(({\n      name,\n      label,\n      isSubmitted,\n      isPristine,\n      isValidating,\n      isValid,\n      isVisited,\n    }, index) => ({\n      index,\n      name,\n      label,\n      isPristine: isPristine ?? false,\n      isSubmitted: isSubmitted ?? false,\n      isValid: isValid ?? false,\n      isValidating: isValidating ?? false,\n      isVisited: isVisited ?? false,\n    }))\n    .map((x, index) => ({ ...x, index }));\n\n  const currentStep = enabledSteps\n    .find((x) => x.name === (localFormState.navigatedStepName || localFormState.initialStepName))\n    || null;\n\n  return {\n    ...methods,\n    ...(shouldSubscribe(subscribe, 'form') ? {\n      resetKey: localFormState.resetKey,\n      isSubmitted: localFormState.isSubmitted,\n      isValid: localFormState.isValid,\n      isValidating: localFormState.isValidating,\n      isPristine: localFormState.isPristine,\n      steps: enabledSteps,\n      currentStep: currentStep || {},\n      isStepPristine: currentStep ? currentStep.isPristine : localFormState.isPristine,\n      isStepValid: currentStep ? currentStep.isValid : localFormState.isValid,\n      isStepValidating: currentStep ? currentStep.isValidating : localFormState.isValidating,\n      isStepSubmitted: currentStep ? currentStep.isSubmitted : localFormState.isSubmitted,\n      isFirstStep: enabledSteps[0]?.name === currentStep?.name,\n      isLastStep: enabledSteps[enabledSteps.length - 1]?.name === currentStep?.name,\n    } : {}),\n    ...(shouldSubscribe(subscribe, 'fields') ? {\n      values: getFormValues(localFields),\n    } : {}),\n    __connect__: connect,\n  };\n};\n"],"names":["isObject","x","constructor","Object","parseValues","values","keys","reduce","acc","key","parseValuesName","name","indexOf","value","nextValues","split","current","otherNames","isArraySyntax","match","currentName","currentIndex","currentCollection","length","group","join","getFormValues","fields","filter","field","isEnabled","obj","getFormUniqueId","Math","random","toString","substr","getFieldUniqueId","getFieldHtmlUniqueId","formId","fieldName","useRefValue","ref","useRef","useSubject","valueRef","throttle","subjectRef","Subject","push","next","subscription","pipe","throttleTime","undefined","leading","trailing","useBehaviorSubject","BehaviorSubject","updateStep","state","partialStepState","stepIndex","steps","findIndex","step","newStep","JSON","stringify","newSteps","orderedSteps","sort","a","b","order","enabledSteps","initialStepName","newState","unregisterStep","resetForm","resetKey","isSubmitted","isValid","navigatedStepName","map","isVisited","registerField","newField","find","id","otherFields","updateField","unregisterField","fieldId","setFieldsValues","objectOfValues","newFields","setFieldsExternalErrors","objectOfErrors","externalErrors","defaultFormState","isValidating","isPristine","FormContext","React","useFormContext","useContext","getCurrentStep","formState","currentStepName","Formiz","autoForm","children","connect","onChange","onSubmit","onValidSubmit","onInvalidSubmit","onValid","onInvalid","formStateRef","fieldsRef","keepValuesRef","connectRef","__connect__","onChangeRef","onSubmitRef","onValidSubmitRef","onInvalidSubmitRef","onValidRef","onInvalidRef","onFormUpdate","onFieldsUpdate","onExternalFieldsUpdate","onReset","checkFormValidity","every","errors","asyncErrors","checkStepValidity","stepName","checkFormPristine","checkStepPristine","checkFormValidating","some","checkStepValidating","updateFormState","stateToUpdate","goToStep","targetedStepIndex","nextStep","isLastStep","prevStep","isFirstStep","submit","e","preventDefault","formatedValues","submitStep","currentStep","fieldsActions","invalidateFields","getFieldStepName","validateForm","formActions","shouldKeepValue","reset","formMethods","contextValue","actions","subjects","useEffect","Provider","noValidate","ErrorFieldWithoutForm","Error","ErrorFieldWithoutName","ErrorStepWithoutForm","ErrorStepWithoutName","StepContext","useStepContext","FormizStep","as","Tag","label","style","rest","useState","setFormState","setState","isActive","subscribe","unsubscribe","prevState","display","fieldPropTypes","PropTypes","string","isRequired","debounce","number","defaultValue","any","formatValue","func","required","oneOfType","bool","node","validations","arrayOf","shape","rule","message","deps","asyncValidations","keepValue","fieldDefaultProps","val","getValidationsWithRequired","useField","isMountedRef","stepContext","initValue","valueDebounced","stateRef","nameRef","stepNameRef","validationsRef","asyncValidationsRef","debounceRef","formatValueRef","defaultValueRef","keepValueRef","setValue","error","validateField","fieldErrors","validation","shouldRunAsyncValidations","Promise","all","rules","fieldAsyncErrors","timer","setTimeout","clearTimeout","cur","allErrors","errorMessage","errorMessages","shouldSubscribe","useForm","methods","setMethods","localFormState","setLocalFormState","localFields","setLocalFields","localFieldsRef","subscriptionsRef","subscribeOnFormUpdate","subject","subscribeOnFieldsUpdate","subscribeFields","nextFields","nextState","includes","useCallback","_formMethods","_subjects","forEach","index","isStepPristine","isStepValid","isStepValidating","isStepSubmitted"],"mappings":"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"}